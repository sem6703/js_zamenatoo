<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/x-icon" href=
"data:image/gif;base64,R0lGODlhEAAQAPcAAOLr0sr9ysj7yMn8ycv+y+Lq0cT/yMr7ycP2w8r+ysn9ycf6x7/9w8f4xtH/0anbqcL0wtT/1L7xvsz/zMb5xuPr0sz9y87/zrzwvDZqNmGUYbvvu12QXaXYpc//z5zPnMT3xOPs0sr/zsf5xtX/1azgrBtOGzFkMZLFkg9CDztuO3SndJHEkUBzQLPms+Lr0X2ue1KFUpTHlJ7SnkJ1QnCjcFGEUW2gbUV4RSleKSBTIB1QHancqcX/yjlrOF+SX0J1QViLWKjbqDhrODZpNoi7iNr/2o3BjTBiMFCDULnsucb/ykN1QprNm0l8SS5hLhxPHDptOhBDEAw/DKPWo9j/2Mv/y6/ir8L1wuLp0Mv/z2yfazltOnmseTJlMjVoNVqNWh5SHprNmtb/1sf+x83/zcX4xeHoz87/077wvYS3hJnMmTlsOYa5hmSZZHKkct//38T4xK3grbvuu9Xcw83/0Nv/2dL/0ZzOnEB0QVaJVou/i06BToe8hz1vPV6RXnqBaF+bY4OzgXqueTttOlKEU7PlstL/0rLnsyVZJkd6SCRXJChbKBVIFabZplhfRh1YICFOHjFhL1CATrPjs9T/0s3/zMv9ydD/z1yOWjtsOnOkcqXXpCJWIY/Cj2RqUlSaXWSibKPlrLb3v8f/0MT/zsL/zMv/1a3wt6fpsdL/3Gmrc5/Sn3xoVlFEJZl/aO/UvujNtuTKs+TMteXNtebPt+jQuOXOtefOt+TLs+nRt9rFq9bYt8nQt4m6iHipd7HjsMb4xQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQEewABACwAAAAAEAAQAAAI/wABFChQIcSLFwCynKED6NGnVr0CGGBgQISIHku0oKkTCBIoV74EHGhgYQQMH0y2pLEjKFKoV78GCBiQQEKMH024qLkzSJIoWMAEIAhwgYQMIE6GyMBDaNKoWMEEEHCAocQMDU+6rMlTiBIpWVETPMhggkYQKF7Y6DFUqdSsBQICQNBwooaQKF/amDlkyRStuAEiXPhgY4gUMFWMDLhkqtaAAAoIbEBxg8iUMG72IMJ0ytaAzxI4pMBRhIqYN3wSZUJ1i8JjBx1UrDBSZQwcD4o0pcL1WcCECCtyHLFCJk6fRZtK5YK7YIIHFjqQXCkjxw8jTqp09abwocWOJCXMzBj506jTql1SP4NwwUMJFgRmJDjyxIqXgIAAOw==">




  <title>Замена-211en</title>
  <style>
  /* интересные места пометил юникодами для быстрого поиска */
  /* запрет создания новых квадратов♟*/
  /* черные квадраты не кликабельны♯ */
  /*♚ ♛ ♜ ♝ ♞ ♠ ♡ ♢ ♣ ♤ ♥ ♦ ♧ ♩ ♪ ♫ ♬ ♭ ♮ ♯ ⓭ */
  
  
  /* демо геймплея https://www.youtube.com/watch?v=CJJdfhSjgFA */
/*
* Prefixed by https://autoprefixer.github.io/ru/
* PostCSS: v8.4.14,
* Autoprefixer: v10.4.7
* Browsers: last 4 version
*/

*:not(hr), *::after, *::before {
	-webkit-box-sizing: border-box;
	box-sizing: border-box;
	margin:0;
	padding:0;
	border:0
	}

ul {list-style-type: none}
 
body{
	font-family: sans-serif;
	background-color:#ded
	} 
#i{
	padding: 33px 0;
	background: -webkit-gradient(linear, left top, left bottom, from(grey), to(#ded));
	background: -o-linear-gradient(grey, #ded);
	background: linear-gradient(grey, #ded); 
	text-align: center;
	}


.ira{
	position: absolute;
	cursor: move; 
	color: white;
	display: -ms-grid;
	display: grid; 
	place-items:center; 
	-webkit-user-select: none; 
	-moz-user-select: none; 
	-ms-user-select: none; 
	user-select: none;
	font-size:16px;
	width:25px; 
	height: 20px;
    z-index: 9;
	background: navy;
	}
.iba{
	margin: 0 2px;
	display: -ms-grid;
	display: grid; 
	place-items: center; 
	-webkit-user-select: none; 
	-moz-user-select: none; 
	-ms-user-select: none; 	
	width: 25px;	
	font-size: 16px;
	color: white;
	background: navy;
	cursor: move;
	user-select: none;
    }	


.km{margin:2px;
	display: -ms-grid;
	display: grid; place-items: center;
	width:43px;  
	border:4px solid blue;
	position: fixed; bottom: 0px;
	background: white;
	font-family : monospace;
	font-size:24px;
	-o-text-overflow: clip;
	   text-overflow: clip;
	color:black;
	letter-spacing:1px;
	z-index:6;
	}


.a:before{
	content: '';
	display:  block;
	position: absolute;
	width: 5px; 
	height: 20px;
	top: -27px;
	left: 15px;
	background: blue;
	}



.b:after{
	content: '';
	display: block;
	position: absolute;
	width: 35px; 
	height: 5px;
	top: -12px;
	left: 2px;
	background: blue;
	}
legend{
	font-family: monospace;
	font-size: 24px;
	text-align: center;
	color: blue;
	}


#m1,#m2,#m3{
	margin: auto; 
	color: white; 
	text-align: left;
	border: 5px solid white;
	font-family : monospace;
	width: -webkit-fit-content;
	width: -moz-fit-content;
	width: fit-content;
	padding: 20px 4%;
	font-size: 22px;
	letter-spacing: 8px;
	line-height: 37px;
	max-width: 800px;
	}
#m1{
	position: absolute; 
	top: 0; 
	left: 0;
	border: 5px solid #ffffff00;
	color: #00000080;
	background: white;
	}
#m2{
	position: absolute; 
	top: 0; 
	left: 0;
	background: transparent;
	padding-top: 5px;
	color: purple;
	font-weight: 700;
	}
#m3{
	visibility:hidden;
	}

article{
	margin: auto;
	position: relative;
	width: -webkit-fit-content;
	width: -moz-fit-content;
	width: fit-content;
	}

#ty{
	padding-top: 100px;
	display: -webkit-box;
	display: -ms-flexbox;
	display: flex;
	-webkit-box-pack: center;
	-ms-flex-pack: center;
	justify-content: center; 
	-webkit-box-align: start; 
	-ms-flex-align: start; 
	align-items: flex-start;
	-ms-flex-wrap: wrap;
	flex-wrap: wrap; 
	visibility: hidden;
	position: fixed; 
	bottom: 10px;
	width: 100%;
	height: 444px;
	background: fuchsia;
	z-index: 5;
	}
#fa{
	width: 100%;
	height: 444px;
	background: transparent;
	position: fixed; 
	bottom: 0;
	display: -webkit-box;
	display: -ms-flexbox;
	display: none;/*flex; */
	-webkit-box-align: start;
	-ms-flex-align: start; 
	align-items: flex-start;
	-ms-flex-wrap: wrap;
	flex-wrap: wrap;
	z-index:6;
	}

button{
	margin: 1px;
	padding: 8px 8px; 
	background: #efd;
	border: 2px solid blue; 
	border-radius: 5px;
	font-size: 21px;
	cursor:pointer;
	-webkit-transition: all 1s;
	-o-transition: all 1s;
	transition: all 1s
	}
button:hover{background: #fff;}
p{
	height: 444px; 
	visibility: hidden;
	}
nav{
	position: fixed;
	top: 20px;
	left: 0;
	display: -webkit-box;
	display: -ms-flexbox;
	display: none;/*flex; */
	-webkit-box-orient: vertical; 
	-webkit-box-direction: normal; 
	-ms-flex-direction: column; 
	flex-direction: column;
	}
#cop{
	width: calc(100% - 6px);
	height: 222px;
	background: #ded;
	position: absolute; 
	left: -9999px;
	}
	
/* proga 2 */

#i100{padding: 33px 0;background: linear-gradient(rgba(0,0,0,0.9), blue); 
text-align: center;
}

.ki{
	margin:1px;width:45px;height:60px;
	position: relative;
	display: inline-block;
	background: url(img/hat.png);
	background-position: left 0px top -328px;
	background-size: 2500%;/*auto;*/
	b0ackground-size: cover;
	background-repeat: no-repeat;
	background-attachment: local;
	border:4px solid white; border-radius:4px;
	}
.kolvo{
	p0adding:2px;
	position: absolute;
	font-weight:900;
	color: blue;
	bottom:0; right:0;
	w0idth:15px; a0spect-ratio:1;
	background: none;/*white;*/
	text-shadow: -1px -1px 0px white, 2px -1px 0px white, -1px 2px 0px white, 2px 2px 0px white;
	}	
.meta{
	padding:2px;
	position: absolute;
	bottom:0; left:0;
	width:15px; aspect-ratio:1;
	background: white;
	
	}

	
	

.uni{display: none;}

.ki:has(.uni:checked){border-color: lime;}

#b23{padding:10px;cursor:pointer;border-radius:12px;}

.ink1{fill:gold !important;}
  </style>  
</head>
<body>
<div id="bug">890</div>
	<nav id="nav">
		<button id="btn1" onclick="
			ir.forEach((x,i)=>{
				x.style.top=ib[i].offsetTop+'px';
				x.style.left=ib[i].offsetLeft+'px';});	
			conny();// вывод деши
		">reset</button>
		<button onclick="
			cop.value=m2.innerText;
			cop.select();
			document.execCommand('copy');
			window.getSelection()?.removeAllRanges();
			m1.style.color='#00000000';//.value='';//
		">copy</button>
		<button onclick="
			navigator.clipboard.readText()
				.then(text => {
				text=[...text].map(i=>i.toUpperCase()).join('');
				cop.value=text;
				main(cop.value);
				btn1.onclick();
				})
				.catch(err => {
				console.log('Oblomingo flyed pass', err);
				});
				
		">paste</button>		
	</nav>
	<textarea id="cop">для копирования</textarea>
	
	
<!-- begin proga 2  -->	
<section id="pro2">
<div id="kv" style="position:fixed;top:44px;left:6px;
background-color: black;width:223px; height:670px;a0spect-ratio:1;
padding:1px;
">
<button id="b23" style="visibility:hidden;">union</button><br>
<button class="ki" style=""></button>

</div>

<div id="barright" style="position:fixed;top:44px;right:118px;
background-color: black;width:93px; height:670px;a0spect-ratio:1;
padding:1px;
">
<button onclick="shz(this)"></button><br>
<button onclick="shz(this)">*</button><br>
<button onclick="shz(this)">a</button><br>
<button onclick="shz(this)">b</button><br>
<button onclick="shz(this)">c</button><br>
<button onclick="shz(this)">f</button><br>
<button onclick="shz(this)">d</button><br>
<button onclick="shz(this)">e</button><br>
</div>

<div id="d1" style="margin-top: 33px;width:23px;aspect-ratio:1; background: yellow;border:5px solid white;display:none;v0isibility:hidden;"></div>
<center>
<button id="bph" style="
margin:0; padding:0;
overflow:hidden;
h0eight:328px;
background: #23282c;
background-image: url(img/hat.png);
background-position: left top;
background-size: cover;
background-repeat: no-repeat;
background-attachment: local;
">	
<!-- <svg id="g" width="450" height="328" viewBox="0 0 450 328" fill="none" -->


<svg id="g" width="900" height="410" viewBox="0 0 900 410" fill="none" onclick="

/*
//bug.innerText=`${event.layerX-bph.offsetLeft} ${event.layerY-bph.offsetTop}`;//
bug.innerText='WHOLE '+whole+' XORS '+xors;
if(whole.length>0){
let x1=event.layerX-bph.offsetLeft;
let y1=event.layerY-bph.offsetTop;
may=whole.map(i=>mat(i));
console.table(may);
let a=may.map(i=>{let x=i.cx-x1, y=i.cy-y1; return {r:(x*x)+(y*y),n:i.ux}});// ~расстояния
a=a.sort((i,j)=>i.r-j.r)[0];
let e=document.getElementById('ux'+a.n);
if(e.getAttribute('fill')=='lime')
	{
		e.setAttribute('opacity','.5');
		e.setAttribute('fill','red');
		e.setAttribute('stroke','red');
		e.classList.remove('ink1');
	}else{
		e.setAttribute('opacity','.2');
		e.setAttribute('fill','lime');
		e.setAttribute('stroke','red');
		e.classList.remove('ink1');
	}
}	*/	
//return;// запрет создания новых квадратов♟
if(r) {r=false; return 0;}
let xx=event.clientX-bph.offsetLeft;
let yy=event.clientY-bph.offsetTop;
let hh=35;
let ww=24;
if (yy>fu1&amp;&amp;yy<fu2&amp;&amp;xx>fx) // попадание в фарватер  
    {
    if((xx-fx)>15){xx=fx+20.7} // ускорение разметки моноширинных элементов- при клике в конец строки, будут добавляться квадраты шириной 20,7
    //console.log(xx-fx);
    //alert(yy+ ' '+fu1+' '+fu2);
    yrr.push({x:fx,y:fu1,w:xx-fx,h:fu2-fu1,
    stroke:'red',opacity:'0.2',fill:'lime',a:' ',});
    fx=xx;
    fu1=fu1; // каждый щелчек задает новый фарватер
    fu2=fu2;        
    }
    else
    {
    yrr.push({x:xx,y:yy,w:ww,h:hh,
    stroke:'red',opacity:'0.2',fill:'lime',a:' ',});
    fx=xx+ww;
    fu1=yy; // каждый щелчек задает новый фарватер
    fu2=yy+hh;    
    
    }
 
fx_wat();// слежка за fx
let w=yrr.push()-1;
q=w;// курсор квадратов//
ben=true;
g.innerHTML+=`<rect id=ux${w} x=${(yrr[w].x).toFixed(1)} y=${yrr[w].y} width=${(yrr[w].w).toFixed(1)} height=${yrr[w].h} opacity=.2 fill=lime stroke=red onclick=fn(this,this.getAttribute('fill'),${w})></rect>\r\n`;
">
<line id="line" x1="898.6000000000004" y1="1" x2="898.6000000000004" y2="2500" stroke="teal"></line>

</svg>



</button>
<!--  opacity=.2 fill=lime stroke=red  -->
<!--   class=ink1 -->

<div id=i100>
<button id="btn10" style="margin-right:100px;padding: 4px;border-radius: 4px;font-size: 16px;">do group</button>
<button id="btn2" style="display:none; padding: 4px;border-radius: 4px;font-size: 16px;"
onclick="
	proga=proga^1^2;
	//alert(proga);
	if (proga===2){
	fa.style.display='none';
		nav.style.display='none';
		//kv.style.display='block';
		pro2.style.display='block';
		}
	if (proga===1){
		fa.style.display='flex';
		nav.style.display='flex';
		pro2.style.display='none';
		}
	//
	ss=ta1.value;
	main(ss);
	btn1.onclick();
"
> NEXT 🔻️ </button>
<label style="color:white;"><input type="checkbox" id="noblack">uncklickable black</label>

</div>
<textarea id="ta1" rows="2" cols="90" style="color: white; background: #1a0e5a;">

</textarea>

</section>
	
<!-- end proga 2  -->		
	

	<div id=i>
		<article>
			<div id="m3"></div>
			<div id="m1"></div>
			<div id="m2"></div>
		</article>
		<div id="ty"></div>
	</div>
	<form id="fa"></form>
	<p></p>	

<script>
'use strict';
//*******************************************************************
//*******************************************************************
//**a, q,yrr,ben, fx, fu1, fu2, hb, bb, aa, alf, m, mySet, kax, kay, r,**
const kax=1.0;//2.06*0.49;//2.6;//1.6;//
const kay=1.0;//2.06*0.49;//2.6;
let fu1=0, fu2=0, fx=0;
let q=0;// курсор квадратов
let bb=[];// все группв букв
let r=false;
let ben=true;
//let ux;
let yrr=[


];
let bvb=[];// все группв букв + метка
let whole=[],part=[],xors=[];// от кнопки расформировать, от кнопки групировать, разница этих двух
let may=[];// точки центры

//*квадраты есть, остального нет. получить остальное из квадратов
let a=[...document.querySelectorAll('[id^="ux"]')];
yrr=a.map((i,j)=>{
return {
	  a:' ',
	  x:i.getAttribute('x'),
	  y:i.getAttribute('y'),
	  width:i.getAttribute('width'),
	  height:i.getAttribute('height'),
	  opacity:i.getAttribute('opacity'),	  
	  fill:i.getAttribute('fill'),	  
	  stroke:i.getAttribute('stroke'),
}
});


//function fn(x){x.setAttribute('fill',['lime','none'][1^['lime','none'].indexOf(x.getAttribute('fill'))])}
//let c=['lime','none'];
//let c=['none','lime'];
function fn(x,y,z)
	{
	if(!whole.length){
	ben=true;
	if(y=='lime')
	{x.setAttribute('fill','red');x.setAttribute('opacity','.5');yrr[z]['fill']='red'}
	if(y=='red')//else
	{x.setAttribute('fill','lime');x.setAttribute('opacity','.2');yrr[z]['fill']='lime'}
	if(y=='black')//else
	{
	if(noblack.checked)return;//некликабелен ♯
	x.setAttribute('fill','lime');x.setAttribute('opacity','.2');yrr[z]['fill']='lime'}
	r=true;
	q=z;//
	}
	}

btn10.addEventListener('click',()=>{// лепим группу
	let m=[];
	/*let a7=[...document.querySelectorAll('[id^="ux"]')];

m=[];
	*/
	//********** bb перестраиваю в bvb
	 
	 let a7=[...document.querySelectorAll('[id^="ux"]')];
	a7.forEach((x,i)=>{if(x.getAttribute('fill')=='red')
		{
		x.setAttribute('fill','black');
		x.setAttribute('opacity','.5');
		m.push(i)}}); 
	bvb=bvb.filter(i=>!i.a.every(j=>m.includes(j)));// подмассивы удаляю
	m.forEach(x=>{bvb=bvb.map(i=>
	{return {a:i['a'].filter(k=>k!==x),s:i.s,}})
	});// дубли элементов удаляю
	//bvb=bvb.filter(i=>i['a'].length);//пустые массивы удалить
	bvb=bvb.filter(i=>i.a.length);//пустые массивы удалить
	if (m.length) bvb.push({a:m,s:''});

	bvb.sort((a,b)=>b.a.length-a.a.length);
	//**************
	let alf='АБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯабвгдеёжзийклмнопрстуфхцчшщъыьэюя';
	/*bb.forEach((x,i)=>{x.forEach(j=>{yrr[j]['a']=alf[i]})});
	let aa=yrr.map(i=>i['a']).join('');
	console.log(bb);
	ta1.value=aa;*/
	//***********
	bvb.forEach((x,i)=>{x.a.forEach(j=>{yrr[j]['a']=alf[i]})});
	//let aa=yrr.map(i=>i['a']).join('');
	console.log(bvb);

	//**********

	bbgun();// построение кнопок групп
	part=m.map(i=>i);
	xors=whole.filter(i=>part.every(j=>j!==i));// оставшиеся
	whole=[];//xors.map(i=>i);
	bug.innerText='WHOLE '+whole+' XORS '+xors;
});//btn10.'click' группировка

function svet(x){
console.log('я вызвался '+bb[x]);
let a=[...document.querySelectorAll('[id^="ux"]')];
//bb[x].forEach((y,i)=>{a[y].classList.toggle('ink1')});
//*******
bvb[x].a.forEach((y,i)=>{a[y].classList.toggle('ink1')});
}

function si(){// обьединение множеств
let a=[...document.querySelectorAll('[id^="ux"]')];
a.forEach(i=>{i.classList.remove('ink1')});
	let kiss=[...document.querySelectorAll('.uni')];
	let ra=[];
	/*kiss.forEach((x,i)=>{if(x.checked){
	//alert(`обьединяши [${ra}] и [${bb[i]}]`);
	ra=ra.concat(bb[i]);bb[i]=[];}});
	bb=bb.filter(i=>i.length);//пустые массивы удалить
	//alert(ra);
	if (ra.length) bb.push(ra);
	bb.sort((a,b)=>b.length-a.length);ra=[];	
	*/
	//***********
	 
	kiss.forEach((x,i)=>{if(x.checked){
	//alert(`обьединяши [${ra}] и [${bb[i]}]`);
	//ra=ra.concat(bb[i]);bb[i]=[];}});	 
	ra=ra.concat(bvb[i].a);bvb[i].a=[];}});
	
	bvb=bvb.filter(i=>i.a.length);//пустые массивы удалить
	//alert(ra);
	if (ra.length) bvb.push({a:ra,s:'!'});
	bvb.sort((a,b)=>b.a.length-a.a.length);	
	//***********
bbgun();// построение кнопок групп	
/*	let hb=bb.map((i,j)=>
	'<label class="ki" onmousedown="svet('+j+')" style="background-position: left -'+
	(yrr[i[0]]['x']*kax)+'px top -'+
	(yrr[i[0]]['y']*kay)+'px">\r\n'+
	'<input class="uni" type="checkbox">\r\n'+
	'</label>');
	kv.innerHTML='<button id="b23"'+((bb.length>1)?'':' style="visibility:hidden;"')+
	'>union</button>'+
	'<button id="b24"'+((bb.length>0)?'':' style="visibility:hidden;"')+
	'>destroy</button>'+
	'<br>'+hb.join('');	

	b23.onclick=si;// обьединяем группы
	b24.onclick=ci;// дестроим группу	
	console.log(bb);
	*/
///////////**/*/*//	
	}//si групировка групп
	
function ci(){ // дестрой группы
// найдем одну группу под снос
// 
let a=[...document.querySelectorAll('label.ki')];
let a2=a.map(i=>i.querySelector('.uni').checked).filter(i=>i);
if(a2.length!==1) return;


/*let a3=document.querySelector('label.ki:has(.uni:checked)');
a.forEach((x,i)=>{if(x.querySelector('.uni').checked){del=i; bb[i].forEach(y=>
	{
	let e=document.getElementById('ux'+y);
	e.setAttribute('opacity','.2');
	e.setAttribute('fill','lime');
	e.setAttribute('stroke','red');
	e.classList.remove('ink1');
	}
)}});
bb=bb.filter((x,i)=>i!==del);*/
//************
 //del;
 a=[...document.querySelectorAll('label.ki')]; 
let del; 
a.forEach((x,i)=>{if(x.querySelector('.uni').checked){
	del=i; 
	whole=bvb[i].a.map(z=>z);
	bvb[i].a.forEach(y=>
		{
		let e=document.getElementById('ux'+y);
		e.setAttribute('opacity','.2');
		e.setAttribute('fill','lime');
		e.setAttribute('stroke','red');
		e.classList.remove('ink1');
		})
	}});
bvb=bvb.filter((x,i)=>i!==del);
part=[];
xors=whole.map(i=>i);//whole.filter(i=>part.every(j=>j!==i));// оставшиеся
//********
//alert(bb+'   '+del);
bbgun();// построение кнопок групп

}	// ci дестрой

function bbgun(){// построение кнопок групп
	console.log('bvb='+bvb);
	/*console.log('bb='+bb);	
	let hb=bb.map((i,j)=>
	'<label class="ki" onmousedown="svet('+j+')" style="background-position: left -'+
	(yrr[i[0]]['x']*kax)+'px top -'+
	(yrr[i[0]]['y']*kay)+'px">\r\n'+
	'<input class="uni" type="checkbox">\r\n'+
	'<div class="meta">'+'</div>\r\n'+//	+(bvb[j]['s']??'')
	'<div class="kolvo">'+bb[j].length+'</div>\r\n'+	
	'</label>');
	kv.innerHTML='<button id="b23"'+((bb.length>1)?'':' style="visibility:hidden;"')+
	'>union</button>'+
	'<button id="b24"'+((bb.length>0)?'':' style="visibility:hidden;"')+
	'>destroy</button>'+
	'<br>'+hb.join('');	

	b23.onclick=si;// обьединяем группы
	b24.onclick=ci;// дестроим группу	

	console.log(bb);*/
	//************
	//let
	let hb=bvb.map((i,j)=>
	'<label class="ki" onmousedown="svet('+j+')" style="background-position: left -'+
	(yrr[i.a[0]]['x']*kax)+'px top -'+
	(yrr[i.a[0]]['y']*kay)+'px">\r\n'+
	'<input class="uni" type="checkbox">\r\n'+
	'<div class="meta">'+(bvb[j]['s']??'')+'</div>\r\n'+	
	'<div class="kolvo">'+bvb[j]['a'].length+'</div>\r\n'+	
	'</label>');
	kv.innerHTML=
	'<button id="b25"'+((bvb.length>-1)?'':' style="visibility:hidden;"')+// остаток
	'>%</button>'+	
	'<button id="b24"'+((bvb.length>0)?'':' style="visibility:hidden;"')+
	'>destroy</button>'+	
	'<button id="b23"'+((bvb.length>1)?'':' style="visibility:hidden;"')+
	'>union</button>'+
	'<br>'+hb.join('');	

	b23.onclick=si;// обьединяем группы
	b24.onclick=ci;// дестроим группу	
	b25.onclick=ni;// выделяем остаток	
	console.log(bvb);	
	//*************
	//let alf='АБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯабвгдеёжзийклмнопрстуфхцчшщъыьэюя';
	let alf='ОНЕАИТСМВЫЛЗРЙКЯДПУБХГЖЧЬШФЩЦЮЭЪЁонеаитсмвылзрйкядпубхгжчьшфщцюэъё';
	bvb.forEach((x,i)=>{x.a.forEach(j=>{yrr[j]['a']=alf[i]})});	
	let aa=yrr.map(i=>i['a']).join('');
	ta1.value=aa;
}

function ni(){// остаток
xors.forEach((x,i)=>{
		let e=document.getElementById('ux'+x);
		e.setAttribute('opacity','.5');
		e.setAttribute('fill','red');
		e.setAttribute('stroke','red');
		e.classList.remove('ink1');
});
}

function fx_wat(){// слежка за fx
	line.setAttribute('x1',fx);
	line.setAttribute('x2',fx);
	}
 //********************* выбранная точка перемещается курсорными клавишами
 document.addEventListener('keydown', (e) => {// ←↑↓→
    //if(ux)
	
	if(!(yrr[q])) return 0;
	//alert(q);
	switch(e.keyCode) {
		case 40: {//↓
		e.preventDefault();// чтобы не скроллилось курсорными клавишами
		 if(ben)
		  {
		  yrr[q]['y']=yrr[q]['y']+1;
		  fu1++;
		  fu2++;
		  }
		  else
		  {
		  yrr[q]['h']=yrr[q]['h']+1;
		  fu2++;
		  }
		  //ux.setAttribute('y',yrr[0]['y']);
		  //alert(ux.getAttribute('y'));
		  break;
		}
		case 38: {//↑
		e.preventDefault();
			if(ben)
		  {	
		  yrr[q]['y']=yrr[q]['y']-1;
		  fu1--;
		  fu2--;
		  }
		  else
		  {
		  yrr[q]['h']=yrr[q]['h']-1;
		  fu2--;
		  }
		  break;
		}	  
		case 39: {//→
		e.preventDefault();
			if(ben)
			{
		  yrr[q]['x']=yrr[q]['x']+1;
		  fx++;
		  }
		  else
		  {
		  yrr[q]['w']=yrr[q]['w']+1;
		  fx++;
		  }
		  break;
		}
		case 37: {//←
		e.preventDefault();
			if(ben)
			{
		  yrr[q]['x']=yrr[q]['x']-1;
		  fx--;
		  }
		  else
		  {
		  yrr[q]['w']=yrr[q]['w']-1;
		  fx--;
		  }
		  break;
		}
		case 96: { // numpad0
			ben=!ben;
			yrr[q]['stroke']=['purple','red'][+ben];
			break;
		}
		case 32: //space
		btn10.click();
		
		default: break;
	  }
	  fx_wat();// слежка за fx
	   
	  let a=[...document.querySelectorAll('[id^="ux"]')];
	  a[q].setAttribute('x',(yrr[q]['x']).toFixed(1));
	  a[q].setAttribute('y',(yrr[q]['y']).toFixed(1));
	  a[q].setAttribute('width',(yrr[q]['w']).toFixed(1));
	  a[q].setAttribute('height',(yrr[q]['h']).toFixed(1));
	  /*
	 a[q].setAttribute('opacity',yrr[q]['opacity']);	  
	  a[q].setAttribute('fill',yrr[q]['fill']);	  
	  a[q].setAttribute('stroke',yrr[q]['stroke']);*/
	  
	  }

	);
	
function shz(x){// добавил метку к группе
let a=[...document.querySelectorAll('.uni')];

//a.forEach((y,i)=>{if(y.checked){bbv[i]=x.innerText;   }});//alert(bbv); 
//******getElementById('ux'+i).;
[...document.querySelectorAll('[id^="ux"]')].forEach(x=>{x.classList.remove('ink1')});
a.forEach((y,i)=>{if(y.checked){bvb[i].s=x.innerText;  }});// alert(bvb); 
//******
bbgun();

}	

const mat=z=>{return {
	cx:+yrr[z]['x']+yrr[z]['width']/2,
	cy:+yrr[z]['y']+yrr[z]['height']/2,
	ux:z
}}
//may=[mat(77),mat(204),mat(300),mat(488)];
//**************************

//*******************************************************************
//*******************************************************************
//*******************************************************************
/*обьединил обе программы в одну */
var proga=2;
var ir,ib;
let ws;// коорды размеры башен

      //  А  Б  В  Г  Д  Е  Ё  Ж  З  И  Й  К  Л  М  Н  О  П  Р 
const fqru=[21,7 ,14,4 ,9 ,34,0 ,4 ,12,21,11,11,12,16,35,38,8 ,12,
		//  С  Т  У  Ф  Х  Ц  Ч  Ш  Щ  Ъ  Ы  Ь  Э  Ю  Я  _
			18,19,8 ,2 ,5 ,1 ,4 ,3 ,2 ,0 ,13,3 ,0 ,0 ,11,45];
			
//A82B15C28D43E127F22G20H61I70J2K8L40M24N68O75P19Q1R60S63T91U28V10W24X2Y20Z1			
		// A   B   C   D   E   F   G   H   I   J   K   L   M
const fqen=[ 82, 15, 28, 43,127, 22, 20, 61, 70,  2,  8, 40, 24, 

		//  N   O   P   Q   R   S   T   U   V   W   X   Y   Z
			68, 75, 19,  1, 60, 63, 91, 28, 10, 24,  2, 20,  1];	
let fq=fqen;
		
const ef='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';

const af=[...'АБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ'];
const qf=[...'ОНЕАИТСМВЫЛЗРЙКЯДПУБХГЖЧЬШФЩЦЮЭЪЁ'];

const afru=[...'АБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ'];
/*
const af=[...'ABCDEFGHIJKLMNOPQRSTUVWXYZ'];
const qf=[...'ETAOINSHRDLCUMWFGYPBVKJXQZ'];
*/

let f;
let o; // обьект
let p;// множество для алфавита шифротекста
let hu,hi;
let t=[];// abcd
let s1;

ty.innerHTML=qf.map((x,i)=>
	{
	//alert(((fq[af.indexOf(x)])/60+21)+'px;">');
	return '<div class="iba" style="height:'+
	(fq[af.indexOf(x)]/4+21)+ // делю частоту на 4 а то слишком высокие английские столбы
	'px;">'+x+'</div>'}).join('');





function dragElement(ass) {//Make the DIV element draggagle:
	var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
	ass.onmousedown = dragMouseDown;

	function dragMouseDown(e) {
		e = e || window.event;
		// get the mouse cursor position at startup:
		pos3 = e.clientX;
		pos4 = e.clientY;
		document.onmouseup = closeDragElement;
		// call a function whenever the cursor moves:
		document.onmousemove = elementDrag;
		}

	function elementDrag(e) {
		e = e || window.event;
		// calculate the new cursor position:
		pos1 = pos3 - e.clientX;
		pos2 = pos4 - e.clientY;
		pos3 = e.clientX;
		pos4 = e.clientY;
		// set the element's new position:
		ass.style.top = (ass.offsetTop - pos2) + "px";
		ass.style.left = (ass.offsetLeft - pos1) + "px";
		}

	function closeDragElement() {
		/* stop moving when mouse button is released:*/
		document.onmouseup = null;
		document.onmousemove = null;
		[...ir].forEach((x,i)=>{localStorage.setItem(`myXCat211${i}`,x.offsetLeft)});
		[...ir].forEach((x,i)=>{localStorage.setItem(`myYCat211${i}`,x.offsetTop)});
		conny();// вывод деши
		}
}


/*
const ss='И ФЭПЭ ШИЩРЮСЩЬД ЦПСЮЖЮ. ПЦСДЧЩЭ, ЖБЫРСХЭ, ЖЮЖ АЭСГХЭ ЮОБЦЬГЮГХ. Щ ЬЮБЮК, ЖЦГЦБХК ЖЮЛЮСЬН Ь ЛЭТСЩ ЦМЭФД ЦПХЖФЦИЭФФХТ, ВСХС ФЮИЬГБЭМЫ ЦПСЮЖЮТ, ПЫШГЦ ВЦШФНГХК И ФЭПЦ ЖЦБЮПСД. Ю ШИЦБ ФЮВЦТЩФЮС ВЦИЭБУФЦЬГД ВСЮФЭГХ, ЫИЩШЭФФЫЯ Ь ЖЦЬТЩМЭЬЖЦК ИХЬЦГХ. ЦЬГБЦИЖЩ ВХСДФЦК ГБЮИХ, ВЭБЭЬХВЮФФЦК ЬЭШХТЩ ЧЮБЩЖЮТЩ ЦШЫИЮФМЩЖЦИ, ПХСЩ ВЦУЦАЩ ФЮ ЛЭСЭФХК ЮБУЩВЭСЮР, Ю ШЦАШЭИЮН ИЦШЮ И ПЦМЖЭ Ы ЬЮБЮН, ЬСЦИФЦ ЖБЫРСЦЭ ЦЛЭБЦ И ЦГИЭЬФХУ ПЭБЭРЮУ, ЬИЭГЩСЦЬД РЦСЫПЦК ЬЩФЭИЦК. ТЮСДМЩЖ СЯПЩС ИЬЭТЫ ФЮ ЬИЭГЭ ШЮИЮГД ЩТЭФЮ Щ ФЮЛИЮФЩН. ЦФЩ ИЬЭРШЮ ВБЩШЫТХИЮСЩЬД ЬБЮЛЫ. ЛЭБЖЮСДЕЭ ИЦШХ И ПЦМЖЭ ЦФ ФЮЛИЮС ЦЛЭБЦТ ЬЩФЭРЦ ЬИЭГЮ, Ю ВНГФЮ ГБЮИХ ЮБУЩВЭСЮРЦТ ФЭЩЛИЭШЮФФХУ СЭЬЦИ.';
*/
/*
const ss='НЕГИ ВЛА БНВ ЖЕКОВГБ ФБДУАЕЙА ЁЕА ЕФЙЛДБС ВГ ЖЕКОВГБ ЁЖЁЗАИК НГЕ БАП ТБГПМАЗСА ДБ ВЛА ПГЕМЗ ГН РМГЖТЖЛЁДБ ВАЖЛБГМГСДАЙ! "ЁБ ДБУАЙВИАБВ ДБ ТБГПМАЗСА ЁМПЁКЙ ОЁКЙ ВЛА РАЙВ ДБВАЕАЙВ."  РАБХЁИДБ Н.  МДИДВАЗ АЗДВДГБ ГН БНВ  "ЖЕКОВГБ ЁЖЁЗАИК - ДБУАЙВИАБВ ДБ ТБГПМАЗСА"  (ЧШЦ ДБ ВГВЁМ),  ПЛДЖЛ ПАЕА ГРВЁДБАЗ РК ВЛА НДЕЙВ ИАИРАЕЙ ГН ВЛА ОЕДУЁВА ЖЕКОВГБ ЁЖЁЗАИК ОЕГХАЖВ. ЗДЙЖГЕЗ ЖЕКОВГБ - ЖИЗ: !ЕАЗЕГГИ';

main(ss);
*/
let ss;// шифротекст


function main(ss){
fa.innerHTML=qf.map((x,i)=>
	{return '<div class="ira" style="height:'+
	(fq[af.indexOf(x)]/4+21)+
	'px;">'+x+'</div>'}).join('');

//p=new Set([...ss].filter(x=>af.indexOf(x)>-1));
p=new Set([...ss].filter(x=>afru.includes(x)));

const d=Array.from(p).join('');//горд



const q=[...ss].filter(x=>afru.includes(x))//afru.indexOf(x)>-1)// частота
	.reduce((a,x)=>{a[x]=~~a[x]+1;return a},{})
const c=[...afru].filter(i=>i in q).sort((a,b)=>q[b]-q[a]).map(i=>q[i]-1);//21,14,13

const qa=[...afru].filter(i=>i in q).sort((a,b)=>q[b]-q[a]).join('');//отеиc
s1=[...ss].map(x=>(qa.includes(x))?ef[qa.indexOf(x)]:x).join('');
//alert(qa); qa.indexOf(x)>-1
//********************************************

const booa=[...ef].map(x=>{/// однобукыенные слова
	let e=new RegExp('\\b'+x+'\\b','g');
	return e.test(s1);
});

const boob=[...ef].map(x=>{/// удвойенные буквы
	let e=new RegExp(x+x);
	return e.test(s1);
});

let sot=new Set();// ТИПА ключ шифрования замены
let key=[];
[...ss].forEach(x=>{
	if((af.indexOf(x)>-1)&&!sot.has(x))key.push(x); 
	sot.add(x)
});
key=key.concat(af.filter(x=>!sot.has(x)));


//***************************************
t=[];
for (let i=0; i<d.length; i++){t.push(ef[i])}
t=t.join('');
	
	
	
let iq4=[...t].map((x,i)=>//аддитивное обьединение двух колод - небоскребы и буквы
'<fieldset class="km'+
`${(booa[i])?' a':''}`+ //вертикальный штрих
`${(boob[i])?' b':''}`+ // горизонтальн штрих
	'" style="left:'+(i*46)+'px">'+x+'</fieldset>').join('');	
fa.innerHTML+=iq4;
ir=[...document.querySelectorAll('.ira')];// подвижные элементы
ib=[...document.querySelectorAll('.iba')];// неподвижные элементы         
ir.forEach((x,i)=>{x.style.left = (localStorage.getItem(`myXCat211${i}`)||ib[i].offsetLeft)+'px';});
ir.forEach((x,i)=>{x.style.top = (localStorage.getItem(`myYCat211${i}`)||1)+'px';});
af.forEach((x,i)=>{dragElement(ir[i])});
//*****************************

hu=document.querySelectorAll('.km');
// проверить что есть здания разной высоты, иначе схлопнется
//if (c.every(i=>i===c[0])) 
//alert(c);
hi=c.map((x,i)=>`${43+((c[i]*400/c[0])|0)}px`);
//alert(hi);
[...hu].forEach((x,i)=>{x.style.height=hi[i]});// высота небоскребов
const sit=()=>{
	ws=[...hu].map(x=>{return {// коорды посадочных мест
		x1:x.offsetLeft,
		x2:x.offsetLeft+x.offsetWidth,
		y1:x.offsetTop,
		y2:x.offsetTop+x.offsetHeight
	}});
}

sit();// пересчет коорд посадок
conny();// вывод деши

window.onresize=()=>{sit()}
//*******************
}// end main

function conny(){// вывод деши
	o=[...t].reduce((a,x)=>{a[x]='.'; return a},{});
	[...ir].forEach((x,i)=>{
		let v=x.offsetLeft+ 12;
		let w=x.getBoundingClientRect().top+20;
		let b=x.innerText;
		for(let j=0; j<t.length;j++){//в какую башню попал
			f=w>ws[j].y1&&w<ws[j].y2;
			if(f&&(v>ws[j].x1)&&(v<ws[j].x2)){o[t[j]]=b}	
		}
	});
	m1.innerHTML=[...s1].map(x=>x).join('');//DAS
	m2.innerHTML=[...s1].map(x=>(x in o)?o[x]:x).join('');
	m3.innerHTML=m2.innerHTML;
}
</script>   
</body>
</html>
